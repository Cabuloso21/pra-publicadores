
<div id="status"></div>

<form id="meuFormulario">
  <input type="text" placeholder="Nome" disabled />
  <input type="email" placeholder="Email" disabled />
  <button type="submit" disabled>Enviar</button>
</form>

<button id="gerarPagamento">ğŸ’³ Gerar Pagamento</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // ğŸ”‘ ConfiguraÃ§Ã£o Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCqkWODpY54YGrvqPVMABK_k_ZJLo1KXMA",
    authDomain: "teste-cfe69.firebaseapp.com",
    databaseURL: "https://teste-cfe69-default-rtdb.firebaseio.com",
    projectId: "teste-cfe69",
    storageBucket: "teste-cfe69.firebasestorage.app",
    messagingSenderId: "646579509123",
    appId: "1:646579509123:web:5565c595f322cf3ba308b6",
    measurementId: "G-81YQG8L41X"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const statusDiv = document.getElementById("status");
  const form = document.getElementById("meuFormulario");
  const btnPagamento = document.getElementById("gerarPagamento");

  // ID do usuÃ¡rio
  const userId = "usuario123";

  // =================== Cria documento do usuÃ¡rio ===================
  async function criarUsuario() {
    await setDoc(doc(db, "usuarios", userId), {
      pagamento: false,
      criadoEm: serverTimestamp()
    });
    statusDiv.textContent = "UsuÃ¡rio criado. FormulÃ¡rio bloqueado atÃ© o pagamento.";
  }

  // =================== Escuta mudanÃ§as no pagamento ===================
  onSnapshot(doc(db, "usuarios", userId), (docSnap) => {
    if (docSnap.exists()) {
      const data = docSnap.data();
      if (data.pagamento === true) {
        // Desbloqueia o formulÃ¡rio
        form.querySelectorAll("input, button").forEach(el => el.removeAttribute("disabled"));
        statusDiv.textContent = "âœ… Pagamento aprovado! FormulÃ¡rio desbloqueado.";
      } else {
        form.querySelectorAll("input, button").forEach(el => el.setAttribute("disabled", true));
        statusDiv.textContent = "â³ Pagamento pendente. FormulÃ¡rio bloqueado.";
      }
    }
  });

  // =================== BotÃ£o simula geraÃ§Ã£o de pagamento ===================
  btnPagamento.addEventListener("click", async () => {
    // Aqui vocÃª pode gerar o Pix ou Mercado Pago
    const chavePix = "00020126580014BR.GOV.BCB.PIX...";
    statusDiv.textContent = `ğŸ’³ Copie o cÃ³digo Pix: ${chavePix}`;

    // Se quiser, jÃ¡ cria o documento do usuÃ¡rio se nÃ£o existir
    await criarUsuario();
  });

  // =================== SubmissÃ£o do formulÃ¡rio ===================
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    alert("FormulÃ¡rio enviado com sucesso!");
    form.reset();
  });
</script>
