<div id="saida"></div>
<div id="status-pagamento" style="margin-top:10px; font-weight:bold;"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

// ðŸ”‘ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCWH18dhHz0EBY5Ycc4wjZ1H6AlO-51sho",
  authDomain: "teste1-66092.firebaseapp.com",
  projectId: "teste1-66092",
  storageBucket: "teste1-66092.firebasestorage.app",
  messagingSenderId: "517435649522",
  appId: "1:517435649522:web:a6826c13b1e2c5062acf6b",
  measurementId: "G-3GVBBV8W7C"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const saida = document.getElementById("saida");
const statusDiv = document.getElementById("status-pagamento");

// UsuÃ¡rio logado (ou identificador Ãºnico)
const usuarioId = "usuario123";

// ===================== FormulÃ¡rio bloqueado =====================
const form = document.createElement("form");
form.id = "formularioExemplo";

const campoNome = document.createElement("input");
campoNome.placeholder = "Nome";
campoNome.disabled = true;

const campoProduto = document.createElement("input");
campoProduto.placeholder = "Produto";
campoProduto.disabled = true;

const btnEnviar = document.createElement("button");
btnEnviar.textContent = "Enviar formulÃ¡rio";
btnEnviar.type = "submit";
btnEnviar.disabled = true;

form.appendChild(campoNome);
form.appendChild(campoProduto);
form.appendChild(btnEnviar);

form.addEventListener("submit", async e=>{
  e.preventDefault();
  alert("FormulÃ¡rio enviado com sucesso!");
  form.reset();
});

saida.appendChild(form);

// ===================== BotÃ£o de pagamento Pix =====================
const btnPix = document.createElement("button");
btnPix.textContent = "ðŸ’³ Pagar via Pix";
btnPix.style.padding = "10px 15px";
btnPix.style.cursor = "pointer";

btnPix.addEventListener("click", async () => {
  // CÃ³digo Pix do usuÃ¡rio
  const chavePix = "00020126580014BR.GOV.BCB.PIX0136e7da7da8-fc3a-4616-80d1-c4d1567e166752040000530398654044.005802BR5925Jamily Allyson Menezes Si6009SAO PAULO62140510wgAmrOxuDA6304E413";

  saida.innerHTML = `<p>ðŸ’³ Copie o cÃ³digo Pix abaixo e realize o pagamento:</p>
                      <input value="${chavePix}" readonly style="width:80%; padding:10px">`;
  statusDiv.textContent = "Aguardando pagamento...";

  // Cria documento no Firestore para este pagamento
  await setDoc(doc(db, "pagamentos", usuarioId), {
    aprovado: false,
    criadoEm: serverTimestamp()
  });

  // ðŸ”¹ Observa alteraÃ§Ãµes no Firestore
  onSnapshot(doc(db, "pagamentos", usuarioId), (docSnap) => {
    if(docSnap.exists()){
      const data = docSnap.data();
      if(data.aprovado){
        desbloquearFormulario(form.id);
      }
    }
  });
});

saida.appendChild(btnPix);

// ===================== FunÃ§Ã£o desbloquear formulÃ¡rio =====================
function desbloquearFormulario(formId){
  const form = document.getElementById(formId);
  form.querySelectorAll("input,textarea,button").forEach(el => el.disabled = false);
  statusDiv.textContent = "Pagamento aprovado! FormulÃ¡rio desbloqueado âœ…";
}
</script>
