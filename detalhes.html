<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>teste detalhe</title>
</head>
<body>
  


  <style>
    .detalhes {
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 5px;
      margin: 20px;
    }
    .detalhes input {
      display: block;
      margin-bottom: 10px;
      padding: 8px;
      width: 100%;
    }
    button {
      padding: 10px 20px;
      margin-right: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #salvar {
      background-color: seagreen;
      color: white;
    }
    #excluir {
      background-color: crimson;
      color: white;
    }
  </style>
</head>
<body>

<h2>Detalhes do Estudante</h2>
<div class="detalhes" id="detalhes-estudante">Carregando...</div>
<button id="salvar">Salvar alterações</button>
<button id="excluir">Excluir estudante</button>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCqkWODpY54YGrvqPVMABK_k_ZJLo1KXMA",
    authDomain: "teste-cfe69.firebaseapp.com",
    projectId: "teste-cfe69",
    storageBucket: "teste-cfe69.appspot.com",
    messagingSenderId: "646579509123",
    appId: "1:646579509123:web:dd23b863dd8c54bca308b6",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore();

  const estudante = JSON.parse(localStorage.getItem('estudanteSelecionado'));
  const detalhes = document.getElementById('detalhes-estudante');
  const botaoSalvar = document.getElementById('salvar');
  const botaoExcluir = document.getElementById('excluir');

  if (estudante) {
    detalhes.innerHTML = `
      <input type="text" id="nome" value="${estudante.nome}" placeholder="Nome">
      <input type="text" id="livro" value="${estudante.livro}" placeholder="Livro">
      <input type="text" id="capitulo" value="${estudante.capitulo}" placeholder="Capítulo">
      <input type="text" id="tema" value="${estudante.tema}" placeholder="Tema">
      <input type="text" id="licao" value="${estudante.licao}" placeholder="Lição">
      <input type="text" id="whatsapp" value="${estudante.whatsapp?.replace("https://wa.me/", "") || ""}" placeholder="WhatsApp (apenas número)">
    `;
  } else {
    detalhes.textContent = "Nenhum estudante selecionado.";
    botaoSalvar.style.display = "none";
    botaoExcluir.style.display = "none";
  }

  // SALVAR ALTERAÇÕES
  botaoSalvar.addEventListener('click', async () => {
    const nome = document.getElementById('nome').value.trim();
    const livro = document.getElementById('livro').value.trim();
    const capitulo = document.getElementById('capitulo').value.trim();
    const tema = document.getElementById('tema').value.trim();
    const licao = document.getElementById('licao').value.trim();
    const whatsapp = document.getElementById('whatsapp').value.trim();

    const atualizado = {
      nome,
      livro,
      capitulo,
      tema,
      licao,
      whatsapp: whatsapp ? `https://wa.me/${whatsapp}` : ""
    };

    try {
      if (estudante.id) {
        await updateDoc(doc(db, "estudantes", estudante.id), atualizado);
      }
      localStorage.setItem("estudanteSelecionado", JSON.stringify({ ...atualizado, id: estudante.id }));
      alert("Dados atualizados com sucesso!");
    } catch (error) {
      alert("Erro ao salvar alterações.");
      console.error(error);
    }
  });

  // EXCLUIR
  botaoExcluir.addEventListener('click', async () => {
    if (confirm("Tem certeza que deseja excluir este estudante?")) {
      try {
        if (estudante.id) {
          await deleteDoc(doc(db, "estudantes", estudante.id));
        }
        localStorage.removeItem("estudanteSelecionado");
        window.location.href = "lista.html"; // redireciona para lista
      } catch (error) {
        alert("Erro ao excluir estudante.");
        console.error(error);
      }
    }
  });
</script>

</body>
</html>


