
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>testando</title>
</head>
<body>
  

  <style>
    #botoes-topo {
      position: fixed;
     margin-top: 20px;
      left: 10px;
      display: flex;
      gap: 10px;
      z-index: 1000;
      background: orange;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .detalhes {
      margin-top: 100px;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    input, textarea {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      padding: 5px;
    }
  </style>
</head>
<body>

<h2>Detalhes</h2>
</div>
<div id="botoes-topo">
  <button id="btnEditar">Editar</button>
  <button id="btnExcluir">Excluir</button>
</div>

<div id="whatsapp-container" style="display: none; margin: 20px;">
  <textarea id="mensagemWhatsApp" rows="3" placeholder="Digite uma mensagem..."></textarea>
  <button id="enviarWhatsApp">Enviar no WhatsApp</button>
</div>

<div class="detalhes" id="detalhes-estudante">Carregando...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCqkWODpY54YGrvqPVMABK_k_ZJLo1KXMA",
    authDomain: "teste-cfe69.firebaseapp.com",
    projectId: "teste-cfe69",
    storageBucket: "teste-cfe69.appspot.com",
    messagingSenderId: "646579509123",
    appId: "1:646579509123:web:dd23b863dd8c54bca308b6",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore();

  const detalhes = document.getElementById('detalhes-estudante');
  const btnEditar = document.getElementById('btnEditar');
  const btnExcluir = document.getElementById('btnExcluir');

  let estudante = JSON.parse(localStorage.getItem('estudanteSelecionado'));
  let editando = false;

  function renderDetalhes(data) {
    detalhes.innerHTML = `
      <h3>${data.nome}</h3>
      <p><strong>Livro:</strong> ${data.livro}</p>
      <p><strong>Capítulo:</strong> ${data.capitulo}</p>
      <p><strong>Tema:</strong> ${data.tema}</p>
      <p><strong>Lição:</strong> ${data.licao}</p>
    `;
  }

  function renderEditForm(data) {
    detalhes.innerHTML = `
      <label>Nome:</label>
      <input type="text" id="inputNome" value="${data.nome}" />

      <label>Livro:</label>
      <input type="text" id="inputLivro" value="${data.livro}" />

      <label>Capítulo:</label>
      <input type="text" id="inputCapitulo" value="${data.capitulo}" />

      <label>Tema:</label>
      <input type="text" id="inputTema" value="${data.tema}" />

      <label>Lição:</label>
      <textarea id="inputLicao" rows="3">${data.licao}</textarea>
    `;
    document.getElementById('inputNome').focus();
  }

  btnEditar.addEventListener('click', async () => {
    if (!estudante) return;

    if (!editando) {
      editando = true;
      btnEditar.textContent = "Salvar";
      renderEditForm(estudante);
    } else {
      const novoNome = document.getElementById('inputNome').value.trim();
      const novoLivro = document.getElementById('inputLivro').value.trim();
      const novoCapitulo = document.getElementById('inputCapitulo').value.trim();
      const novoTema = document.getElementById('inputTema').value.trim();
      const novaLicao = document.getElementById('inputLicao').value.trim();

      if (!novoNome) {
        alert("Nome não pode ser vazio.");
        return;
      }

      const ref = doc(db, 'estudantes', estudante.id);

      try {
        await updateDoc(ref, {
          nome: novoNome,
          livro: novoLivro,
          capitulo: novoCapitulo,
          tema: novoTema,
          licao: novaLicao
        });

        estudante = { ...estudante, nome: novoNome, livro: novoLivro, capitulo: novoCapitulo, tema: novoTema, licao: novaLicao };
        localStorage.setItem('estudanteSelecionado', JSON.stringify(estudante));

        editando = false;
        btnEditar.textContent = "Editar";
        renderDetalhes(estudante);
        alert("Dados atualizados com sucesso!");

      } catch (error) {
        console.error("Erro ao atualizar dados:", error);
        alert("Erro ao salvar alterações.");
      }
    }
  });

  btnExcluir.addEventListener('click', async () => {
    if (!estudante) return;

    if (confirm("Tem certeza que deseja excluir este estudante? Esta ação não pode ser desfeita.")) {
      try {
        const ref = doc(db, 'estudantes', estudante.id);
        await deleteDoc(ref);
        localStorage.removeItem('estudanteSelecionado');

        detalhes.innerHTML = "<p>Estudante excluído.</p>";
        document.getElementById("whatsapp-container").style.display = "none";
        btnEditar.disabled = true;
        btnExcluir.disabled = true;

        alert("Estudante excluído com sucesso.");

      } catch (error) {
        console.error("Erro ao excluir estudante:", error);
        alert("Erro ao excluir estudante.");
      }
    }
  });

  if (estudante && estudante.whatsapp) {
    document.getElementById("whatsapp-container").style.display = "block";

    document.getElementById("enviarWhatsApp").addEventListener("click", () => {
      const mensagem = document.getElementById("mensagemWhatsApp").value.trim();
      const numero = estudante.whatsapp.replace("https://wa.me/", "");

      const link = mensagem
        ? `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`
        : `https://wa.me/${numero}`;

      window.open(link, "_blank");
    });
  }

  if (estudante) {
    renderDetalhes(estudante);
  } else {
    detalhes.innerHTML = "<p>Nenhum estudante selecionado.</p>";
  }
</script>

</body>
</html>


