<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>exibi anúncios 41</title>
</head>
<body>

<style>
 body {
 font-family: 'Segoe UI', sans-serif;
 background: white;
 margin: 0;
    
}

header {
background: orange;
padding: 20px;

}

.text {
color: black;
font-size: 18px;
font-weight: bold;
text-align: center;
}


  #lista-anuncios {
    max-width: 350px;
    margin: 0 auto;
   margin-top: 50px;
 }

  .anuncio {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.06);
    margin-bottom: 20px;
    transition: box-shadow 0.3s ease;
    margin-top: 20px;
 }

  .anuncio:hover {
    box-shadow: 0 6px 12px rgba(0,0,0,0.10);
  }

  .anuncio h3 {
    margin: 0 0 10px;
    font-size: 20px;
    color: #333;
    cursor: text;
  }

  .anuncio p {
    margin: 10px 0;
    color: #555;
    cursor: text;
  }

  .anuncio textarea {
    width: 0%;
    height: 440px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    resize: vertical;
    margin-top: 8px;
  }

  .anuncio input[type="tel"] {
    width: 0%;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
  }

  .anuncio button {
    display: inline-block;
    margin-top: 10px;
    margin-right: 10px;
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
  }

  .anuncio button:nth-of-type(1) {
    background-color: 
    color: white;
  }

  .anuncio button:nth-of-type(2) {
    background-color: #f44336;
    color: white;
  }
</style>

<header>
  <div class="text">Minha designação</div>
</header>

<div id="lista-designacoes">Carregando designações...</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  query,
  where,
  getDocs,
  doc,
  updateDoc,
  deleteDoc
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqkWODpY54YGrvqPVMABK_k_ZJLo1KXMA",
  authDomain: "teste-cfe69.firebaseapp.com",
  projectId: "teste-cfe69",
  storageBucket: "teste-cfe69.appspot.com",
  messagingSenderId: "646579509123",
  appId: "1:646579509123:web:dd23b863dd8c54bca308b6"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const lista = document.getElementById("lista-designacoes");

onAuthStateChanged(auth, async (user) => {
  if (!user) return window.location.href = "login.html";

  try {
    const q = query(collection(db, "designacao"), where("uid", "==", user.uid));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
      lista.textContent = "Você ainda não adicionou nenhuma designação.";
      return;
    }

    lista.innerHTML = "";

    querySnapshot.forEach(docSnap => {
      const dados = docSnap.data();
      const designacaoId = docSnap.id;

      const div = document.createElement("div");
      div.className = "designacao";
      div.style.border = "1px solid #ccc";
      div.style.padding = "10px";
      div.style.marginBottom = "10px";
      div.style.borderRadius = "8px";

      // Editar Nome do Produto
      const titulo = document.createElement("h3");
      titulo.contentEditable = true;
      titulo.textContent = dados.produto || "Sem nome";
      titulo.addEventListener("blur", async () => {
        await updateDoc(doc(db, "designacao", designacaoId), { produto: titulo.textContent });
      });

      // Editar Tema
      const tema = document.createElement("p");
      tema.contentEditable = true;
      tema.innerHTML = `<strong>Tema:</strong> ${dados.tema || "Sem tema"}`;
      tema.addEventListener("blur", async () => {
        const novoTema = tema.textContent.replace("Tema:", "").trim();
        await updateDoc(doc(db, "designacao", designacaoId), { tema: novoTema });
      });

      // Campo de descrição (editável)
      const descricao = document.createElement("textarea");
      descricao.placeholder = "Digite a descrição...";
      descricao.value = dados.descricao || "";
      descricao.style.width = "100%";
      descricao.style.marginTop = "8px";
      descricao.addEventListener("blur", async () => {
        await updateDoc(doc(db, "designacao", designacaoId), { descricao: descricao.value });
      });

      // Campo para digitar o WhatsApp antes de enviar
      const inputWhatsapp = document.createElement("input");
      inputWhatsapp.type = "tel";
      inputWhatsapp.placeholder = "Digite o número do WhatsApp";
      inputWhatsapp.style.marginTop = "8px";
      inputWhatsapp.style.width = "100%";

      // Botão de enviar para o WhatsApp
      const botaoWhatsapp = document.createElement("button");
      botaoWhatsapp.textContent = "Enviar para o WhatsApp";
      botaoWhatsapp.style.marginTop = "8px";
      botaoWhatsapp.style.background = "#25d366";
      botaoWhatsapp.style.color = "#fff";
      botaoWhatsapp.style.border = "none";
      botaoWhatsapp.style.padding = "6px 12px";
      botaoWhatsapp.style.borderRadius = "6px";
      botaoWhatsapp.style.cursor = "pointer";

      botaoWhatsapp.addEventListener("click", () => {
        const numero = inputWhatsapp.value.replace(/\D/g, "");
        if (!numero) return alert("Digite um número válido!");
        const mensagem = `Produto: ${titulo.textContent}\nTema: ${tema.textContent.replace("Tema:", "").trim()}\nDescrição: ${descricao.value}`;
        const link = `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`;
        window.open(link, "_blank");
      });

      // Botão de excluir
      const botaoExcluir = document.createElement("button");
      botaoExcluir.textContent = "Excluir";
      botaoExcluir.style.marginTop = "8px";
      botaoExcluir.style.background = "#f44336";
      botaoExcluir.style.color = "#fff";
      botaoExcluir.style.border = "none";
      botaoExcluir.style.padding = "6px 12px";
      botaoExcluir.style.borderRadius = "6px";
      botaoExcluir.style.cursor = "pointer";

      botaoExcluir.addEventListener("click", async () => {
        const confirmar = confirm("Tem certeza que deseja excluir esta designação?");
        if (confirmar) {
          await deleteDoc(doc(db, "designacao", designacaoId));
          div.remove();
        }
      });

      // Adiciona tudo ao card
      div.appendChild(titulo);
      div.appendChild(tema);
      div.appendChild(descricao);
      div.appendChild(inputWhatsapp);
      div.appendChild(botaoWhatsapp);
      div.appendChild(botaoExcluir);

      lista.appendChild(div);
    });

  } catch (error) {
    lista.textContent = "Erro ao carregar designações.";
    console.error(error);
  }
});
</script>

